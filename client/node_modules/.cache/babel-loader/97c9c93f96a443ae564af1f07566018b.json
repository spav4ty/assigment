{"ast":null,"code":"import _regeneratorRuntime from\"/home/spav/Documents/Kurs/Assigment-4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/spav/Documents/Kurs/Assigment-4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/spav/Documents/Kurs/Assigment-4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect}from'react';import{Link,withRouter}from'react-router-dom';import{useStore}from'../store/store';import{SET_AUTH_USER}from'../store/auth';import{TableUsers}from'../components/Table';import{useMutation,useQuery}from'@apollo/client';import{GET_ALL_USERS,LOG_OUT}from'../utils/graphql';import{Button,Container}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AppLayout=function AppLayout(_ref){var _auth$user;var location=_ref.location,authUser=_ref.authUser,refetchUser=_ref.refetch;var _useStore=useStore(),_useStore2=_slicedToArray(_useStore,2),auth=_useStore2[0].auth,dispatch=_useStore2[1];useEffect(function(){dispatch({type:SET_AUTH_USER,payload:authUser});},[dispatch,authUser]);var _useQuery=useQuery(GET_ALL_USERS),data=_useQuery.data,loading=_useQuery.loading,error=_useQuery.error,refetchAllUsers=_useQuery.refetch;var users=data?data===null||data===void 0?void 0:data.allUsers:[];var userId=auth===null||auth===void 0?void 0:(_auth$user=auth.user)===null||_auth$user===void 0?void 0:_auth$user.id;var _useMutation=useMutation(LOG_OUT),_useMutation2=_slicedToArray(_useMutation,2),logout=_useMutation2[0],loadingLogout=_useMutation2[1].loading;var handlerLogOut=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:window.localStorage.removeItem('token');_context.next=3;return logout({variables:{userId:userId}});case 3:_context.next=5;return refetchUser();case 5:case\"end\":return _context.stop();}}},_callee);}));return function handlerLogOut(){return _ref2.apply(this,arguments);};}();if(!auth.user)return null;if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});return/*#__PURE__*/_jsxs(Container,{className:\"vh-100\",children:[/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:handlerLogOut,children:\"Log Out\"}),data&&/*#__PURE__*/_jsx(TableUsers,{data:users,refetchUser:refetchUser,loadingAllUsers:loading,refetchAllUsers:refetchAllUsers})]});};export default withRouter(AppLayout);","map":{"version":3,"sources":["/home/spav/Documents/Kurs/Assigment-4/client/src/pages/AppLayout.js"],"names":["React","useEffect","Link","withRouter","useStore","SET_AUTH_USER","TableUsers","useMutation","useQuery","GET_ALL_USERS","LOG_OUT","Button","Container","AppLayout","location","authUser","refetchUser","refetch","auth","dispatch","type","payload","data","loading","error","refetchAllUsers","users","allUsers","userId","user","id","logout","loadingLogout","handlerLogOut","window","localStorage","removeItem","variables"],"mappings":"seAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CAEA,OAASC,IAAT,CAAeC,UAAf,KAAiC,kBAAjC,CACA,OAASC,QAAT,KAAyB,gBAAzB,CACA,OAASC,aAAT,KAA8B,eAA9B,CACA,OAASC,UAAT,KAA2B,qBAA3B,CACA,OAASC,WAAT,CAAsBC,QAAtB,KAAsC,gBAAtC,CACA,OAASC,aAAT,CAAwBC,OAAxB,KAAuC,kBAAvC,CACA,OAASC,MAAT,CAAiBC,SAAjB,KAAkC,iBAAlC,C,wFAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,MAAiD,mBAA9CC,CAAAA,QAA8C,MAA9CA,QAA8C,CAApCC,QAAoC,MAApCA,QAAoC,CAAlBC,WAAkB,MAA1BC,OAA0B,CACjE,cAA6Bb,QAAQ,EAArC,wCAASc,IAAT,eAASA,IAAT,CAAiBC,QAAjB,eAGAlB,SAAS,CAAC,UAAM,CACdkB,QAAQ,CAAC,CAAEC,IAAI,CAAEf,aAAR,CAAuBgB,OAAO,CAAEN,QAAhC,CAAD,CAAR,CACD,CAFQ,CAEN,CAACI,QAAD,CAAWJ,QAAX,CAFM,CAAT,CAIA,cAAyDP,QAAQ,CAACC,aAAD,CAAjE,CAAOa,IAAP,WAAOA,IAAP,CAAaC,OAAb,WAAaA,OAAb,CAAsBC,KAAtB,WAAsBA,KAAtB,CAAsCC,eAAtC,WAA6BR,OAA7B,CAEA,GAAMS,CAAAA,KAAK,CAAGJ,IAAI,CAAGA,IAAH,SAAGA,IAAH,iBAAGA,IAAI,CAAEK,QAAT,CAAoB,EAAtC,CACA,GAAMC,CAAAA,MAAM,CAAGV,IAAH,SAAGA,IAAH,6BAAGA,IAAI,CAAEW,IAAT,qCAAG,WAAYC,EAA3B,CACA,iBAA2CvB,WAAW,CAACG,OAAD,CAAtD,8CAAOqB,MAAP,kBAAyBC,aAAzB,kBAAgBT,OAAhB,CAEA,GAAMU,CAAAA,aAAa,2FAAG,mIACpBC,MAAM,CAACC,YAAP,CAAoBC,UAApB,CAA+B,OAA/B,EADoB,sBAEdL,CAAAA,MAAM,CAAC,CACXM,SAAS,CAAE,CACTT,MAAM,CAANA,MADS,CADA,CAAD,CAFQ,8BAOdZ,CAAAA,WAAW,EAPG,uDAAH,kBAAbiB,CAAAA,aAAa,2CAAnB,CAUA,GAAI,CAACf,IAAI,CAACW,IAAV,CAAgB,MAAO,KAAP,CAChB,GAAGN,OAAH,CAAY,mBAAQ,mCAAR,CAEZ,mBACE,MAAC,SAAD,EAAW,SAAS,CAAC,QAArB,wBACA,KAAC,MAAD,EAAQ,OAAO,CAAC,QAAhB,CAAyB,OAAO,CAAEU,aAAlC,qBADA,CAECX,IAAI,eAAI,KAAC,UAAD,EAAY,IAAI,CAAEI,KAAlB,CAAyB,WAAW,CAAEV,WAAtC,CAAmD,eAAe,CAAEO,OAApE,CAA6E,eAAe,CAAEE,eAA9F,EAFT,GADF,CAMD,CAjCD,CAwCA,cAAetB,CAAAA,UAAU,CAACU,SAAD,CAAzB","sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link, withRouter } from 'react-router-dom';\nimport { useStore } from '../store/store';\nimport { SET_AUTH_USER } from '../store/auth';\nimport { TableUsers } from '../components/Table';\nimport { useMutation, useQuery } from '@apollo/client';\nimport { GET_ALL_USERS, LOG_OUT } from '../utils/graphql';\nimport { Button, Container } from 'react-bootstrap';\n\nconst AppLayout = ({ location, authUser, refetch:refetchUser }) => {\n  const [{ auth }, dispatch] = useStore();\n\n\n  useEffect(() => {\n    dispatch({ type: SET_AUTH_USER, payload: authUser });\n  }, [dispatch, authUser]);\n\n  const {data, loading, error, refetch: refetchAllUsers} = useQuery(GET_ALL_USERS)\n\n  const users = data ? data?.allUsers : [];\n  const userId = auth?.user?.id;\n  const [logout, {loading: loadingLogout}] = useMutation(LOG_OUT)\n\n  const handlerLogOut = async () => {\n    window.localStorage.removeItem('token');\n    await logout({\n      variables: {\n        userId\n      }\n    })\n    await refetchUser()\n  }\n\n  if (!auth.user) return null;\n  if(loading) return (<div>Loading...</div>)\n\n  return (\n    <Container className=\"vh-100\">\n    <Button variant=\"danger\" onClick={handlerLogOut}>Log Out</Button>\n    {data && <TableUsers data={users} refetchUser={refetchUser} loadingAllUsers={loading} refetchAllUsers={refetchAllUsers}/>}\n    </Container>\n  );\n};\n\nAppLayout.propTypes = {\n  location: PropTypes.object.isRequired,\n  authUser: PropTypes.object.isRequired,\n};\n\nexport default withRouter(AppLayout);"]},"metadata":{},"sourceType":"module"}